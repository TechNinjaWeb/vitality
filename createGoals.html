<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="utf-8" />
   <title>Bootstrap, from Twitter</title>
   <!--<meta name="viewport" content="width=device-width, initial-scale=1.0" />-->
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
   <meta name="description" content="" />
   <meta name="author" content="" />
   <!-- Le styles -->
   <link data-require="bootstrap-css" data-semver="3.3.1" rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" />
   <link data-require="bootstrap@*" data-semver="3.3.5" rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" />
   <link data-require="bootstrap@*" data-semver="3.3.5" rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootswatch/3.3.5/cosmo/bootstrap.min.css" />
   <link data-require="bootstrap@*" data-semver="3.3.5" rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" />
   <link rel="stylesheet" href="style.css">
   <!--<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>-->
   <script type="text/javascript" src="http://www.parsecdn.com/js/parse-latest.js"></script>

   <link href="style.css" rel="stylesheet" />
   <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
   <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
   <!-- Le fav and touch icons -->
   <!--<link rel="shortcut icon" href="images/favicon.ico" />-->
   <link rel="apple-touch-icon" href="images/apple-touch-icon.png" />
   <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png" />
   <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png" />
   <!-- Le javascript
    ================================================== -->
   <script data-require="jquery" data-semver="2.1.4" src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
   <script data-require="bootstrap" data-semver="3.3.5" src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
   <script src="script.js"></script>
</head>

<body id="createGoals">
   <div class="page-container">
      <nav class="navbar navbar-default navbar-fixed-top">
         <div class="header-container container">
            <div class="left-icon col-xs-4"><a href="goalsPage.html"><i class="fa fa-lg fa-arrow-left"></i></a></div>
            <div class="title col-xs-4">
               <div class="nav-title text-center">Goals List</div>
            </div>
            <div class="right-icon col-xs-4 text-right"><a class="save-goals-btn" href="#"><i class="fa fa-lg fa-check"></i></a></div>
         </div>
      </nav>
      <div class="heading col-xs-12">
         <h2 class="heading-title text-center">Create A New Goal</h2>
      </div>
      <div class="page-content container">
         <div class="goal-btns col-xs-12 text-center">
            <div class="calories goal-btn btn btn-responsive btn-primary">Caloric</div>
            <div class="weight goal-btn btn btn-responsive btn-success">Weight</div>
            <div class="emotion goal-btn btn btn-responsive btn-danger">Emotional</div>
            <div class="fitness goal-btn btn btn-responsive btn-info">Fitness</div>
         </div>
         <table class="goal-list table small-container">
            <thead class="table-head">
               <tr>
                  <th>Goal</th>
                  <th class="text-right">Remove</th>
               </tr>
            </thead>
            <tbody class="table-body">
            </tbody>
            <tfoot class="table-foot">
               <tr>
                  <td class="text-right">To edit a goal, click the number or verb you want to change</td>
                  <td></td>
               </tr>
            </tfoot>
         </table>
      </div>
   </div>
   <!--<button class="testBtn btn btn-danger" onclick="window.commands.test()">ADD TEST DATA</button>-->
   <script type="text/javascript">
      var table = document.getElementsByClassName('goal-list');
          table = table[0];
      var tBody = document.getElementsByClassName('table-body');

      var goalBtns = document.getElementsByClassName('goal-btns');
      Array.prototype.slice.call(goalBtns).forEach(function(e){
         e.addEventListener("click", function(ev){
            // console.log("EVENT", ev.target.classList[0], "LOOK FOR DATA", ev.target);
            createAndAppendTr(tBody[0], ev.target.classList[0]);
         });
      });
      
      var saveGoalsBtn = document.getElementsByClassName('save-goals-btn');
      saveGoalsBtn = saveGoalsBtn[0];
      saveGoalsBtn.addEventListener('click', function(e){
         var S = Parse.Object.extend("Goals");
         var s = new S();
         var goals = document.getElementsByClassName('table-style');

         var saveObj = Array.prototype.slice.call(goals).reduce(function(p,c,i,a) {
            var elem = c.childNodes;
            var target = parseInt(elem[3].innerText, 10) || null;
            var type = elem[3].className.split("-");
            var data = c.parentNode.data;

            // console.log("TARGET", target, "ELEMS", elem, "TYPE", type[0], "DATA", data);
            
            p[type[0]] = data;
            return p;
         }, {});
         saveObj.userName = window.commands.userName;
         console.log("Save Object", saveObj);
         s.save(saveObj, {
            success: function(res){console.log("SAVED OBJ WITH RESPONSE", res); return res;},
            error: function(err, res){console.warn(["ERROR HAS OCCURED", err], ["RESPONSE", res]); return {response: res, error: err};}
         }).then(function(res){
            console.log("DO SOMETHING WITH RESPONSE", res);
            window.commands.sendData('/goalsPage.html');
         });
      });
      
      function createAndAppendTr(table, type) {
         var getString = getTypeAndSendString(type);
         var tr = document.createElement('tr');
             tr.data = getString.data;
         var td = document.createElement('td');
         // console.log("STRING DATA", getString.data);
             // DETERMINE NUMBER OR VERB TYPE AND BUILD
             td.innerHTML = getString.string;
             td.className = "table-style";
         var i = document.createElement('i');
             i.className = "fa fa-lg fa-ban";
         var a = document.createElement('a');
             a.className = "delete-btn";
             a.addEventListener("click", removeBtn);
         var del = document.createElement('td');
             del.className = "text-center";
             
         // Add args[2] settings to TD
         var args = Array.prototype.slice.call(arguments);
             !!args[2] ? Array.prototype.slice.call(args[2]).forEach(function(e){
                for (var prop in e) {
                   td[prop] = e[prop];
                }
             }) : null;
             // Add Icon to Anchor
             a.appendChild(i);
             // Add Anchor to Delete TD
             del.appendChild(a);
             // Add Table Data
             tr.appendChild(td);
             tr.appendChild(del);
             table.appendChild(tr);
             
         function removeBtn(ev) {
            var tr = ev.target.parentNode.parentNode.parentNode;
            console.log("REMOVING", tr);
            tr.remove();
         }
      }
      function getTypeAndSendString(type) {
         // ARGS = TYPE, ARRAY, OBJECT
         // Second argument can be activities list
         var args = Array.prototype.slice.call(arguments);
         // console.log("ARGUMETNS", args);
         var tempActivities = [{item: "Some Activity", 
            instructions: "Some Bullet Points", 
            type: 1,
            trackBy: 2
         }, {item: "Some Other Activity", 
            instructions: "Some More Bullet Points", 
            type: 2,
            trackBy: 1
         }];
         var d = args[1] || {
            calories: ["eat", 2000, "calories"],
            weight: ["lose", 10, "pounds"],
            emotion: ["feel", 5, "on the Rate Me scale"],
            fitness: [args[2] || tempActivities, 3]
         };
         // console.log("DATA TO USE", d);
         var tmp;
         var string = "I will ";
         if (type == "calories") {
            string = string+ "<span class='calories-verb'>"+ d[type][0] +"</span> ";
            string = string+ "<span class='calories-number'>"+ d[type][1] +" " + d[type][2] +"</span> per week";
            // console.log("STRING:", string);
            tmp = [d[type][0], d[type][1], d[type][2]];
         }
         if (type == "weight") {
            string = string+ "<span class='weight-verb'>"+ d[type][0] +"</span> ";
            string = string+ "<span class='weight-number'>"+ d[type][1] +" " + d[type][2] +"</span> per week";
            // console.log("STRING:", string);
            tmp = [d[type][0], d[type][1], d[type][2]];
         }
         if (type == "emotion") {
            string = string+ "<span class='emotion-verb'>"+ d[type][0] +"</span> ";
            string = string+ "an average of <span class='emotion-number'>"+ d[type][1] +" " + d[type][2] +"</span> per week";
            // console.log("STRING:", string);
            tmp = [d[type][0], d[type][1], d[type][2]];
         }
         if (type == "fitness") {
            string = string+ "do ";
            string = string+ "<span class='fitness-list'>"+ d[type][0][0].item +"</span> <span class='fitness-number'>" + d[type][1] +" times</span> per week";
            // console.log("STRING:", string);
            tmp = ['do', d[type][0][0], d[type][1]];
         }
         // console.log("DATA IS ARGS OR TEMP?", args[1]);
         return {string: string, data: tmp};
      }
      window.commands.getTypeAndSendString = getTypeAndSendString;
      window.commands.createAndAppendTr = createAndAppendTr;
   </script>
</body>

</html>
