<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Bootstrap, from Twitter</title>
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0" />-->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="description" content="" />
  <meta name="author" content="" />
  <!-- Le styles -->
  <link data-require="bootstrap-css" data-semver="3.3.1" rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" />
  <link data-require="bootstrap@*" data-semver="3.3.5" rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" />
  <link data-require="bootstrap@*" data-semver="3.3.5" rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootswatch/3.3.5/cosmo/bootstrap.min.css" />
  <link data-require="bootstrap@*" data-semver="3.3.5" rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="style.css">
  <!--<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>-->
  <script type="text/javascript" src="http://www.parsecdn.com/js/parse-latest.js"></script>

  <link href="style.css" rel="stylesheet" />
  <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  <!-- Le fav and touch icons -->
  <!--<link rel="shortcut icon" href="images/favicon.ico" />-->
  <link rel="apple-touch-icon" href="images/apple-touch-icon.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png" />
  <!-- Le javascript
    ================================================== -->
  <script data-require="jquery" data-semver="2.1.4" src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script data-require="bootstrap" data-semver="3.3.5" src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script src="script.js"></script>
</head>

<body id="goalsPage">
  <div class="page-container">
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="header-container container">
        <div class="left-icon col-xs-4"><a href="index.html"><i class="fa fa-lg fa-home"></i></a></div>
        <div class="title col-xs-4">
          <div class="nav-title text-center">Goals List</div>
        </div>
        <div class="right-icon col-xs-4 text-right"><a href="/createGoals.html"><i class="fa fa-lg fa-plus"></a></i>
        </div>
      </div>
    </nav>
    <div class="heading col-xs-12">
      <h2 class="heading-title text-center">Review Your Goals or <br>Create New Ones</h2>
    </div>
    <div class="page-content container">
      <table class="goal-list table small-container">
        <thead class="table-head">
          <tr>
            <th>Goal</th>
            <th class="text-right">% of Goal</th>
          </tr>
        </thead>
        <tbody class="table-body">
        </tbody>
      </table>
    </div>
  </div>
  <script type="text/javascript">
    var table = document.getElementsByClassName('table-body');
        table = table[0];
    var conditions = [{
      condition: "equalTo",
      col: "userName",
      val: window.commands.userName,
      limit: 1
    }];
    var goals = window.commands.queryParse('Goals', 'find', conditions);
        goals.then(function(res){
          // console.log("RESPONSE FROM FIRST CHAIN", res);
          var data = Array.prototype.slice.call(res).reduce(function(p,c,i,a){
            // var d = {res: c, data: c.attributes};
            var o = {};
            o[c.id] = c.attributes;
            // console.log("RES", c, "OBJECT", o);
            p.push(o);
            return p;
          }, []);
          
          return buildTable(table, data);;
    });

    // console.log("GOALS", goals);
    
    function buildTable(table, data) {
      data.forEach(function(el){
        // console.log("ELEMENT TO BUILD FOR", el, 'DATA', data);
        for (var prop in el) {
          // console.log("WHAT IS PROP?", prop);
          for (var p in el[prop]) {
            if (p == 'calories' || p == 'emotion' || p == 'fitness' || p == 'weight' ) {
              // console.log("THIS IS ", p, "EL[p]", el[prop][p]);
              createAndAppendTr(table, p, el[prop][p]);
            }
          }
        }
      });
    }
    
    function createAndAppendTr(table, type) {
       var args = Array.prototype.slice.call(arguments);
      // console.log("CREATEAPPEND TYPE", type);
       var getString = getTypeAndSendString(type, args[2]);
       var tr = document.createElement('tr');
       var td = document.createElement('td');
           // DETERMINE NUMBER OR VERB TYPE AND BUILD
           td.innerHTML = getString.string;
           td.data = getString.data;
           td.className = "table-style";
       var goalCompletion = document.createElement('td');
           goalCompletion.className = "text-right table-style";
           goalCompletion.innerHTML = calcCompletion();
           
       // Add args[2] settings to TD
       !!args[2] ? Array.prototype.slice.call(args[2]).forEach(function(e){
          for (var prop in e) {
             td[prop] = e[prop];
          }
       }) : null;

       // Add Table Data
       tr.appendChild(td);
       tr.appendChild(goalCompletion);
       table.appendChild(tr);
           
       function calcCompletion(data) {
          // console.log("CALCULATING COMPLETION");
          return "VALUE IS TBA";
       }
    }
    function getTypeAndSendString(type) {
       // ARGS = TYPE, ARRAY, OBJECT
       // Second argument can be activities list
       var args = Array.prototype.slice.call(arguments);
       var d = args[1];
       
      // console.log(["GET STRING ARGS", args],
      // ["TYPE", type],
      // ["DATA TYPE", d]);
       var string = "I will ";
       if (type == "calories") {
          string = string+ "<span class='calories-verb'>"+ d[0] +"</span> ";
          string = string+ "<span class='calories-number'>"+ d[1] +" " + d[2] +"</span> per week";
          // console.log("STRING:", string);
       }
       if (type == "weight") {
          string = string+ "<span class='weight-verb'>"+ d[0] +"</span> ";
          string = string+ "<span class='weight-number'>"+ d[1] +" " + d[2] +"</span> per week";
          // console.log("STRING:", string);
       }
       if (type == "emotion") {
          string = string+ "<span class='emotion-verb'>"+ d[0] +"</span> ";
          string = string+ "an average of <span class='emotion-number'>"+ d[1] +" " + d[2] +"</span> per week";
          // console.log("STRING:", string);
       }
       if (type == "fitness") {
          string = string+ "<span class='fitness-verb'>"+ d[0] +"</span> ";
          string = string+ "<span class='fitness-list'>"+ d[1].item +"</span> <span class='fitness-number'>" + d[2] +" times</span> per week";
          // console.log("STRING:", string, d);
       }
       return {string: string, data: d};
    }
  </script>
</body>

</html>